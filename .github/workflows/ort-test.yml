name: ORT License Analysis 1.1

on:
  workflow_dispatch:
    inputs:
      analyze:
        description: 'Set to false to disable the execution of the ORT analyze ORT Action'
        required: false
        default: 'true'
      evaluate:
        description: 'Set to false to disable the execution of the ORT evaluate ORT Action'
        required: false
        default: 'true'
      report:
        description: 'Set to false to disable the execution of the ORT report ORT Action'
        required: false
        default: 'true'
  # pull_request:
  # push:
  #   branches:
  #     - '*'

env:
  JAVA_OPTS: "-Xmx8g"

jobs:
  analyze:
    name: ORT License Analysis
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/oss-review-toolkit/ort:29.0.0
      options: --user root
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Create ORT Configuration
        run: |
          mkdir -p .ort
          cat > .ort.yml << 'EOF'
          analyzer:
            allow_dynamic_versions: true
          EOF
      
      - name: Run ORT Analyze
        if: ${{ github.event.inputs.analyze != 'false' }}
        run: |
          ort analyze -i . -o ort-results
      
      - name: Run ORT Evaluate
        if: ${{ github.event.inputs.evaluate != 'false' }}
        run: |
          ort evaluate -i ort-results/analyzer-result.yml -o ort-results
        continue-on-error: true
      
      - name: Run ORT Report
        if: ${{ github.event.inputs.report != 'false' }}
        run: |
          ort report -i ort-results/evaluation-result.yml -o ort-results -f StaticHtml,WebApp
        continue-on-error: true
      
      - name: Upload ORT Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ort-results
          path: ort-results/
          retention-days: 30
          if-no-files-found: ignore